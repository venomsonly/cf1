docker hub name and access token
amitgupta4in
dckr_pat_eK2bXJlDqIps8TKypxDbT1dDHKs




                sh """
                echo "Step 3 of main"
                echo docker login and image building
                yes Y | docker system prune
                yes Y | docker network prune
                """
                
sshagent(['my-ssh-key']) {
    sh 'scp ./nstack.yml $SSH_USER@$SERVERIP:/home/jenkins_home/'
}
stage("5. Configuring SSH and running command"){
    steps{
        echo "Establishing ssh connection"
        sshagent(credentials: ['SSH_PRIVATE_KEY']) {
        sh """
            [ -d ~/.ssh ] || mkdir ~/.ssh && chmod 0700 ~/.ssh
            ssh-keyscan "$SERVERIP" >> ~/.ssh/known_hosts
            ssh -o StrictHostKeyChecking=no "$SSH_USER@$SERVERIP" uptime
            ssh $SSH_USER@$SERVERIP "ls /home/jenkins_home/"
            ssh $SSH_USER@$SERVERIP "touch /home/jenkins_home/test.txt"
        """
        }
    }
}


sh "echo $dockerhub_PSW | docker login -u $dockerhub_USR --password-stdin"


                sshagent(credentials : ["SSH_PRIVATE_KEY"]) {
                    sh 'ssh -o StrictHostKeyChecking=no $SSH_USER@$SERVERIP uptime'

                }
 sh """
                eval "\$(ssh-agent -s)"
                echo "$SSH_PRIVATE_KEY" | ssh-add -
                mkdir ~/.ssh
                chmod 700 ~/.ssh
                ssh-keyscan $SERVERIP >> ~/.ssh/known_hosts
                chmod 644 ~/.ssh/known_hosts
                ssh $SSH_USER@$SERVERIP "ls /root/"
                """

CI/CD.

The flow:
1. One git repo with multiple branches.
2. Each site will have its own branch.
3. Each git branch will contain a .env file and assets (can be local or use api-server).

To-DO:
1. Create a git repo (main branch) with the name 'amt-15-mb-sites'
2. Make amit collaborator for this repo.
3. Make the main branch working for one site. Say 'handyman.us'
4. From the main branch create a new branch with domain name. Say 'handyman.us'
5. Push the new branch to GitHub.

Note:
1. Branch names main, dev, testing will be excluded.
2. Branch name must be the site domain name. Say for site handyman.us, the branch name will be 'handyman.us'.